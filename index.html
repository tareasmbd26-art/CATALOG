<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>QuickTreinta ¬∑ POS + Cat√°logo WhatsApp</title>
    <style>
        /* ===== ESTILOS GENERALES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: #f5f7fb;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .app-container {
            max-width: 480px;
            width: 100%;
            background-color: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            min-height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
            border-radius: 0;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .screen {
            display: none;
            padding: 16px 16px 80px;
            animation: fadeIn 0.2s ease;
        }

        .active-screen {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0.6; }
            to { opacity: 1; }
        }

        /* ===== HEADER ===== */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border-bottom: 1px solid #f0f2f5;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .logo-icon {
            background: linear-gradient(145deg, #1a5cff, #0a3eb0);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .logo-text {
            font-weight: 700;
            font-size: 18px;
            color: #0b1b33;
        }

        .header-actions {
            display: flex;
            gap: 16px;
            color: #4e5b6e;
        }

        .icon-btn {
            font-size: 20px;
            cursor: pointer;
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #ff3b30;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 700;
        }

        /* ===== TARJETAS Y SECCIONES ===== */
        .welcome-card {
            background: linear-gradient(135deg, #f2f6ff, #ffffff);
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid #e9ecf0;
        }

        .business-name {
            font-size: 20px;
            font-weight: 700;
            color: #0a1e3c;
            margin-bottom: 4px;
        }

        .greeting {
            color: #4e5b6e;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            background: white;
            padding: 16px 12px;
            border-radius: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
            margin-top: 8px;
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-label {
            font-size: 12px;
            color: #6f7b8a;
            margin-bottom: 4px;
        }

        .stat-number {
            font-size: 20px;
            font-weight: 700;
            color: #0b1b33;
        }

        .stat-sub {
            font-size: 11px;
            color: #2ecc71;
        }

        /* ===== M√ìDULOS ===== */
        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin: 16px 0 12px 0;
        }

        .section-title h2 {
            font-size: 18px;
            font-weight: 600;
            color: #0a1e3c;
        }

        .section-title a {
            font-size: 14px;
            color: #1a5cff;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .module-item {
            background: #f8fafc;
            border-radius: 20px;
            padding: 20px 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #e9ecf0;
        }

        .module-item:hover {
            background: #e9f2ff;
            transform: translateY(-2px);
        }

        .module-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .module-item span {
            font-size: 13px;
            font-weight: 600;
            color: #0a1e3c;
            text-align: center;
        }

        /* ===== BOTONES ===== */
        .btn {
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, #1a5cff, #0a3eb0);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(26, 92, 255, 0.3);
        }

        .btn-outline {
            background: white;
            color: #1a5cff;
            border: 2px solid #1a5cff;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 13px;
        }

        /* ===== LISTAS ===== */
        .list-card {
            background: white;
            border-radius: 20px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            border: 1px solid #f0f2f5;
            margin-bottom: 16px;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            padding: 14px;
            border-bottom: 1px solid #f5f7fb;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        /* ===== NAVEGACI√ìN INFERIOR ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: white;
            border-top: 1px solid #e9ecf0;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            cursor: pointer;
            flex: 1;
            transition: all 0.2s ease;
            color: #8a92a3;
        }

        .nav-item.active {
            color: #1a5cff;
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-item span:last-child {
            font-size: 11px;
            font-weight: 600;
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #0a1e3c;
        }

        .close-modal {
            font-size: 24px;
            cursor: pointer;
            color: #6f7b8a;
        }

        /* ===== FORMULARIOS ===== */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #0a1e3c;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecf0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #1a5cff;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecf0;
            border-radius: 12px;
            font-size: 15px;
            background: white;
        }

        /* ===== CAT√ÅLOGO P√öBLICO ===== */
        .catalog-product {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid #e9ecf0;
            display: flex;
            gap: 16px;
        }

        .product-image {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            background: #f0f2f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            color: #0a1e3c;
            margin-bottom: 4px;
        }

        .product-description {
            font-size: 13px;
            color: #6f7b8a;
            margin-bottom: 8px;
        }

        .product-price {
            font-size: 18px;
            font-weight: 700;
            color: #1a5cff;
        }

        .product-stock {
            font-size: 12px;
            color: #2ecc71;
            margin-top: 4px;
        }

        .product-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .product-btn {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        .product-btn.edit {
            background: #f39c12;
            color: white;
        }

        .product-btn.delete {
            background: #e74c3c;
            color: white;
        }

        .product-btn.whatsapp {
            background: #25D366;
            color: white;
        }

        /* ===== SHARE LINK ===== */
        .share-box {
            background: linear-gradient(135deg, #f2f6ff, #ffffff);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecf0;
        }

        .share-label {
            font-size: 14px;
            font-weight: 600;
            color: #0a1e3c;
            margin-bottom: 8px;
        }

        .share-link-container {
            display: flex;
            gap: 8px;
        }

        .share-link {
            flex: 1;
            padding: 12px;
            background: white;
            border: 1px solid #e9ecf0;
            border-radius: 12px;
            font-size: 14px;
            color: #4e5b6e;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .copy-btn {
            padding: 12px 20px;
            background: #1a5cff;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        /* ===== RECIBO ===== */
        .receipt {
            background: white;
            border-radius: 16px;
            padding: 20px;
            border: 1px dashed #1a5cff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            margin-bottom: 16px;
        }

        .order-summary {
            background: #f8fafc;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .order-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .order-row.total {
            font-weight: 700;
            border-top: 1px solid #ddd;
            padding-top: 8px;
            margin-top: 8px;
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            z-index: 2000;
            animation: slideUp 0.3s ease;
            max-width: 90%;
            text-align: center;
        }

        @keyframes slideUp {
            from { bottom: 50px; opacity: 0; }
            to { bottom: 100px; opacity: 1; }
        }

        /* ===== RESET SECTION ===== */
        .reset-section {
            background: #fff5f5;
            border-radius: 16px;
            padding: 16px;
            margin-top: 24px;
            border: 1px solid #ffcdd2;
        }

        .reset-title {
            color: #c0392b;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .reset-description {
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ===== HEADER ===== -->
        <div class="app-header">
            <div class="logo-area" onclick="openEditNameModal()">
                <div class="logo-icon">üè™</div>
                <div class="logo-text" id="businessNameDisplay">Mi Tienda</div>
            </div>
            <div class="header-actions">
                <span class="icon-btn" onclick="openNotificationsModal()">
                    üîî
                    <span class="notification-badge" id="notificationCount" style="display: none;">0</span>
                </span>
                <span class="icon-btn" onclick="openSettingsModal()">‚öôÔ∏è</span>
            </div>
        </div>

        <!-- ===== PANTALLA HOME ===== -->
        <div id="home-screen" class="screen active-screen">
            <div class="welcome-card">
                <div class="business-name" id="businessNameHome">Mi Tienda</div>
                <div class="greeting">¬°Vende por WhatsApp y gestiona tu negocio! üëã</div>
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="stat-label">Ventas hoy</div>
                        <div class="stat-number" id="ventasHoy">$0</div>
                        <div class="stat-sub" id="ventasHoyPorcentaje">+0%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Pedidos</div>
                        <div class="stat-number" id="pedidosHoy">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Productos</div>
                        <div class="stat-number" id="totalProductos">0</div>
                    </div>
                </div>
            </div>

            <div class="section-title">
                <h2>Inicio r√°pido</h2>
            </div>

            <div class="modules-grid">
                <div class="module-item" onclick="showScreen('catalogo-screen')">
                    <div class="module-icon">üì±</div>
                    <span>Cat√°logo</span>
                </div>
                <div class="module-item" onclick="showScreen('ventas-screen')">
                    <div class="module-icon">üí∞</div>
                    <span>Ventas</span>
                </div>
                <div class="module-item" onclick="showScreen('inventario-screen')">
                    <div class="module-icon">üì¶</div>
                    <span>Inventario</span>
                </div>
                <div class="module-item" onclick="showScreen('clientes-screen')">
                    <div class="module-icon">üë•</div>
                    <span>Clientes</span>
                </div>
                <div class="module-item" onclick="showScreen('caja-screen')">
                    <div class="module-icon">üíµ</div>
                    <span>Caja</span>
                </div>
                <div class="module-item" onclick="openQuickSellDemo()">
                    <div class="module-icon">‚ö°</div>
                    <span>Venta r√°pida</span>
                </div>
            </div>

            <div class="section-title">
                <h2>üåê Tu cat√°logo p√∫blico</h2>
                <a onclick="previewCatalog()">Vista previa</a>
            </div>
            
            <div class="share-box">
                <div class="share-label">üì± Link de tu tienda (COMPARTE ESTE ENLACE):</div>
                <div class="share-link-container">
                    <input type="text" class="share-link" id="catalogLinkHome" readonly value="cargando...">
                    <button class="copy-btn" onclick="copyCatalogLink('home')">Copiar</button>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 12px;">
                    <button class="btn btn-small" style="flex: 1;" onclick="shareWhatsApp()">
                        üì≤ Compartir en WhatsApp
                    </button>
                    <button class="btn btn-small btn-outline" style="flex: 1;" onclick="previewCatalog()">
                        üëÄ Vista cliente
                    </button>
                </div>
            </div>

            <div class="section-title">
                <h2>√öltimas ventas</h2>
                <a onclick="showScreen('ventas-screen')">Ver todo</a>
            </div>
            <div class="list-card" id="ultimasVentasLista">
                <div class="list-item">No hay ventas recientes</div>
            </div>
        </div>

        <!-- ===== PANTALLA CAT√ÅLOGO P√öBLICO (VISTA CLIENTE) ===== -->
        <div id="catalogo-preview-screen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px; background: white; padding: 12px 16px; border-bottom: 1px solid #f0f2f5; position: sticky; top: 0; z-index: 100;">
                <span style="font-size: 28px; cursor: pointer;" onclick="goBack()">‚Üê</span>
                <div style="flex: 1;">
                    <div style="font-weight: 700; font-size: 18px;" id="previewBusinessName">Mi Tienda</div>
                    <div style="font-size: 12px; color: #6f7b8a;">Cat√°logo digital ‚Ä¢ Haz tu pedido</div>
                </div>
                <span class="icon-btn" onclick="shareWhatsApp()">üì≤</span>
            </div>
            
            <div style="padding: 16px;">
                <div style="background: #f2f6ff; border-radius: 16px; padding: 16px; margin-bottom: 20px; text-align: center;">
                    <div style="font-size: 40px; margin-bottom: 8px;">üõçÔ∏è</div>
                    <div style="font-weight: 600; font-size: 16px;">¬°Haz tu pedido por WhatsApp!</div>
                    <div style="font-size: 13px; color: #6f7b8a; margin-top: 4px;">Selecciona un producto y env√≠a tu pedido</div>
                </div>
                
                <div id="catalogPublicList"></div>
                
                <div style="margin-top: 24px; padding: 16px; background: #f8fafc; border-radius: 16px; text-align: center;">
                    <div style="font-size: 14px; color: #4e5b6e;">¬øEres el due√±o de esta tienda?</div>
                    <button class="btn btn-small btn-outline" style="margin-top: 8px;" onclick="goBack()">
                        Volver a gesti√≥n
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== PANTALLA CAT√ÅLOGO (GESTI√ìN) ===== -->
        <div id="catalogo-screen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <span style="font-size: 28px; cursor: pointer;" onclick="goBack()">‚Üê</span>
                <h1 style="font-size: 24px; font-weight: 700;">Cat√°logo</h1>
            </div>

            <div class="share-box">
                <div class="share-label">üåê Link de tu tienda (COMPARTE ESTO):</div>
                <div class="share-link-container">
                    <input type="text" class="share-link" id="catalogLink" readonly value="cargando...">
                    <button class="copy-btn" onclick="copyCatalogLink('catalog')">Copiar</button>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 12px;">
                    <button class="btn" style="flex: 1;" onclick="shareWhatsApp()">
                        üì≤ Compartir en WhatsApp
                    </button>
                    <button class="btn btn-outline" style="flex: 1;" onclick="previewCatalog()">
                        üëÄ Vista cliente
                    </button>
                </div>
            </div>

            <div class="section-title">
                <h2>Tus productos</h2>
                <a onclick="openAddProductModal()">+ Agregar</a>
            </div>

            <div id="catalogProductList"></div>
        </div>

        <!-- ===== PANTALLA VENTAS ===== -->
        <div id="ventas-screen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <span style="font-size: 28px; cursor: pointer;" onclick="goBack()">‚Üê</span>
                <h1 style="font-size: 24px; font-weight: 700;">Ventas</h1>
            </div>
            
            <div class="stats-row">
                <div class="stat-item"><div class="stat-label">Hoy</div><div class="stat-number" id="ventasHoyScreen">$0</div></div>
                <div class="stat-item"><div class="stat-label">Ayer</div><div class="stat-number" id="ventasAyerScreen">$0</div></div>
                <div class="stat-item"><div class="stat-label">Semana</div><div class="stat-number" id="ventasSemanaScreen">$0</div></div>
            </div>
            
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button class="btn btn-success" style="flex: 1;" onclick="openAddSaleModal()">‚ûï Nueva venta</button>
                <button class="btn btn-outline" style="flex: 1;" onclick="generateSalesReport()">üìä Reporte</button>
            </div>
            
            <div class="section-title">
                <h2>Historial de ventas</h2>
            </div>
            
            <div id="ventasLista" class="list-card"></div>
        </div>

        <!-- ===== PANTALLA INVENTARIO ===== -->
        <div id="inventario-screen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <span style="font-size: 28px; cursor: pointer;" onclick="goBack()">‚Üê</span>
                <h1 style="font-size: 24px; font-weight: 700;">Inventario</h1>
            </div>
            
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button class="btn" style="flex: 1;" onclick="openAddProductModal()">‚ûï Agregar producto</button>
                <button class="btn btn-outline" style="flex: 1;" onclick="exportInventory()">üì§ Exportar</button>
            </div>
            
            <div class="section-title">
                <h2>Productos en stock</h2>
            </div>
            
            <div id="inventoryList" class="list-card"></div>
            
            <div style="margin-top:24px; background:#fff3cd; padding:16px; border-radius:20px;" id="stockCritico">
                <span style="font-weight:600;">‚ö†Ô∏è Stock bajo</span>
                <div style="margin-top:12px;" id="stockCriticoLista"></div>
            </div>
        </div>

        <!-- ===== PANTALLA CLIENTES ===== -->
        <div id="clientes-screen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <span style="font-size: 28px; cursor: pointer;" onclick="goBack()">‚Üê</span>
                <h1 style="font-size: 24px; font-weight: 700;">Clientes</h1>
            </div>
            
            <button class="btn" style="margin-bottom: 16px;" onclick="openAddClientModal()">‚ûï Nuevo cliente</button>
            
            <div class="section-title">
                <h2>Lista de clientes</h2>
            </div>
            
            <div id="clientesLista" class="list-card"></div>
            
            <div style="margin-top: 16px; padding: 16px; background: #eaf4ff; border-radius: 20px;">
                <strong>üìã Control de deudas</strong>
                <p style="font-size: 14px; margin-top: 6px;" id="deudaPendiente">Sin deudas pendientes</p>
            </div>
        </div>

        <!-- ===== PANTALLA CAJA ===== -->
        <div id="caja-screen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <span style="font-size: 28px; cursor: pointer;" onclick="goBack()">‚Üê</span>
                <h1 style="font-size: 24px; font-weight: 700;">Flujo de Caja</h1>
            </div>
            
            <div style="background: linear-gradient(135deg, #2ecc71, #27ae60); border-radius: 20px; padding: 24px; color: white; margin-bottom: 20px;">
                <div style="font-size: 14px; margin-bottom: 8px;">Saldo disponible</div>
                <div style="font-size: 36px; font-weight: 700;" id="saldoDisponible">$0</div>
                <div style="font-size: 13px; margin-top: 8px; opacity: 0.9;">Actualizado en tiempo real</div>
            </div>
            
            <div class="list-card">
                <div class="list-item">
                    <div>
                        <div style="font-weight: 600;">Ventas del d√≠a</div>
                        <div style="font-size: 12px; color: #6f7b8a;" id="transaccionesHoy">0 transacciones</div>
                    </div>
                    <span style="color: #2ecc71; font-weight: 700;" id="ventasHoyCaja">+$0</span>
                </div>
                <div class="list-item">
                    <div>
                        <div style="font-weight: 600;">Gastos del d√≠a</div>
                        <div style="font-size: 12px; color: #6f7b8a;" id="gastosHoyCount">0 registros</div>
                    </div>
                    <span style="color: #e74c3c; font-weight: 700;" id="gastosHoyMonto">-$0</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 8px; margin-top: 16px;">
                <button class="btn btn-success" style="flex: 1;" onclick="openAddSaleModal()">üí∞ Registrar venta</button>
                <button class="btn btn-danger" style="flex: 1;" onclick="openAddExpenseModal()">üí∏ Registrar gasto</button>
            </div>
        </div>

        <!-- ===== PANTALLA CONFIGURACI√ìN / RESET ===== -->
        <div id="config-screen" class="screen">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                <span style="font-size: 28px; cursor: pointer;" onclick="goBack()">‚Üê</span>
                <h1 style="font-size: 24px; font-weight: 700;">Configuraci√≥n</h1>
            </div>
            
            <div class="list-card">
                <div class="list-item" onclick="openEditNameModal()">
                    <span>üè™ Nombre del negocio</span>
                    <span style="color: #1a5cff;" id="configBusinessName">Mi Tienda</span>
                </div>
                <div class="list-item" onclick="openSettingsModal()">
                    <span>‚öôÔ∏è WhatsApp e impuestos</span>
                    <span style="color: #1a5cff;">Editar</span>
                </div>
            </div>
            
            <div class="reset-section">
                <div class="reset-title">‚ö†Ô∏è Reiniciar sistema</div>
                <div class="reset-description">
                    Esto eliminar√° TODOS tus productos, ventas, clientes y configuraciones. 
                    La acci√≥n es irreversible.
                </div>
                <button class="btn btn-danger" onclick="confirmReset()">Reiniciar todo desde cero</button>
            </div>
        </div>

        <!-- ===== BARRA DE NAVEGACI√ìN INFERIOR ===== -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showScreen('home-screen')">
                <span class="nav-icon">üè†</span>
                <span>Inicio</span>
            </div>
            <div class="nav-item" onclick="showScreen('catalogo-screen')">
                <span class="nav-icon">üì±</span>
                <span>Cat√°logo</span>
            </div>
            <div class="nav-item" onclick="showScreen('ventas-screen')">
                <span class="nav-icon">üí∞</span>
                <span>Ventas</span>
            </div>
            <div class="nav-item" onclick="showScreen('inventario-screen')">
                <span class="nav-icon">üì¶</span>
                <span>Stock</span>
            </div>
            <div class="nav-item" onclick="showScreen('config-screen')">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span>M√°s</span>
            </div>
        </div>

        <!-- ===== MODALES ===== -->

        <!-- Modal Editar Nombre -->
        <div id="editNameModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Nombre del negocio</div>
                    <span class="close-modal" onclick="closeEditNameModal()">√ó</span>
                </div>
                <div class="form-group">
                    <label class="form-label">Nombre de tu tienda</label>
                    <input type="text" class="form-input" id="businessNameInput" placeholder="Ej: Panader√≠a El Sol">
                </div>
                <button class="btn" onclick="saveBusinessName()">Guardar</button>
            </div>
        </div>

        <!-- Modal Configuraci√≥n -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Configuraci√≥n</div>
                    <span class="close-modal" onclick="closeSettingsModal()">√ó</span>
                </div>
                
                <div style="margin-bottom: 24px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">üì± WhatsApp</h3>
                    <div class="form-group">
                        <label class="form-label">Tu n√∫mero de WhatsApp</label>
                        <input type="text" class="form-input" id="whatsappNumber" placeholder="Ej: 60001234">
                        <div style="font-size: 12px; color: #6f7b8a; margin-top: 4px;">
                            Los pedidos del cat√°logo llegar√°n a este n√∫mero
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">üîî Notificaciones</h3>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f2f5;">
                        <div>
                            <div style="font-weight: 600; font-size: 14px;">Pedidos nuevos</div>
                            <div style="font-size: 12px; color: #6f7b8a;">Alertas de pedidos por WhatsApp</div>
                        </div>
                        <label class="toggle-switch" style="display: none;">Simplificado, siempre activo</label>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">üí∞ Impuestos</h3>
                    <div class="form-group">
                        <label class="form-label">ITBMS / IVA (%)</label>
                        <input type="number" class="form-input" id="itbmsRate" value="7" min="0" max="100" step="0.1">
                    </div>
                </div>

                <button class="btn" onclick="saveSettings()">Guardar configuraci√≥n</button>
            </div>
        </div>

        <!-- Modal Notificaciones -->
        <div id="notificationsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Notificaciones</div>
                    <span class="close-modal" onclick="closeNotificationsModal()">√ó</span>
                </div>
                <div id="notificationsList"></div>
            </div>
        </div>

        <!-- Modal Agregar Producto -->
        <div id="addProductModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Agregar producto</div>
                    <span class="close-modal" onclick="closeAddProductModal()">√ó</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nombre</label>
                    <input type="text" class="form-input" id="productName" placeholder="Ej: Pan franc√©s">
                </div>

                <div class="form-group">
                    <label class="form-label">Descripci√≥n</label>
                    <input type="text" class="form-input" id="productDescription" placeholder="Breve descripci√≥n">
                </div>

                <div class="form-group">
                    <label class="form-label">Precio</label>
                    <input type="number" class="form-input" id="productPrice" placeholder="0.00" step="0.01">
                </div>

                <div class="form-group">
                    <label class="form-label">Stock</label>
                    <input type="number" class="form-input" id="productStock" placeholder="0">
                </div>

                <div class="form-group">
                    <label class="form-label">Emoji</label>
                    <input type="text" class="form-input" id="productEmoji" placeholder="ü•ñ" maxlength="2">
                </div>

                <button class="btn" onclick="addProductToCatalog()">Agregar al cat√°logo</button>
            </div>
        </div>

        <!-- Modal Registrar Venta -->
        <div id="addSaleModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Registrar venta</div>
                    <span class="close-modal" onclick="closeAddSaleModal()">√ó</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Cliente</label>
                    <select class="form-select" id="saleClient">
                        <option value="Mostrador">Mostrador (Cliente general)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Producto</label>
                    <select class="form-select" id="saleProduct">
                        <option value="">Selecciona un producto</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Cantidad</label>
                    <input type="number" class="form-input" id="saleQuantity" value="1" min="1">
                </div>

                <div class="form-group">
                    <label class="form-label">M√©todo de pago</label>
                    <select class="form-select" id="salePaymentMethod">
                        <option value="Efectivo">Efectivo</option>
                        <option value="Tarjeta">Tarjeta</option>
                        <option value="Transferencia">Transferencia</option>
                        <option value="Nequi">Nequi</option>
                    </select>
                </div>

                <div id="saleSummary" class="order-summary">
                    <div class="order-row">
                        <span>Subtotal:</span>
                        <span id="saleSubtotal">$0.00</span>
                    </div>
                    <div class="order-row">
                        <span>ITBMS (7%):</span>
                        <span id="saleTax">$0.00</span>
                    </div>
                    <div class="order-row total">
                        <span>Total:</span>
                        <span id="saleTotal">$0.00</span>
                    </div>
                </div>

                <button class="btn" onclick="registerSale()">Registrar venta y generar recibo</button>
            </div>
        </div>

        <!-- Modal Recibo de Venta -->
        <div id="receiptModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">üßæ Recibo de venta</div>
                    <span class="close-modal" onclick="closeReceiptModal()">√ó</span>
                </div>
                
                <div id="receiptContent" class="receipt"></div>
                
                <div style="display: flex; gap: 8px; margin-top: 16px;">
                    <button class="btn btn-outline" style="flex: 1;" onclick="copyReceipt()">üìã Copiar</button>
                    <button class="btn" style="flex: 1;" onclick="shareReceiptWhatsApp()">üì≤ Enviar por WhatsApp</button>
                </div>
            </div>
        </div>

        <!-- Modal Registrar Gasto -->
        <div id="addExpenseModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Registrar gasto</div>
                    <span class="close-modal" onclick="closeAddExpenseModal()">√ó</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Categor√≠a</label>
                    <select class="form-select" id="expenseCategory">
                        <option value="Insumos">üßæ Insumos</option>
                        <option value="Servicios">üí° Servicios</option>
                        <option value="Transporte">üöó Transporte</option>
                        <option value="Publicidad">üì¢ Publicidad</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Descripci√≥n</label>
                    <input type="text" class="form-input" id="expenseDescription" placeholder="Ej: Compra de harina">
                </div>

                <div class="form-group">
                    <label class="form-label">Monto</label>
                    <input type="number" class="form-input" id="expenseAmount" placeholder="0.00" step="0.01">
                </div>

                <button class="btn" onclick="registerExpense()">Registrar gasto</button>
            </div>
        </div>

        <!-- Modal Nuevo Cliente -->
        <div id="addClientModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Nuevo cliente</div>
                    <span class="close-modal" onclick="closeAddClientModal()">√ó</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nombre</label>
                    <input type="text" class="form-input" id="clientName" placeholder="Nombre completo">
                </div>

                <div class="form-group">
                    <label class="form-label">WhatsApp</label>
                    <input type="text" class="form-input" id="clientPhone" placeholder="6000-0000">
                </div>

                <button class="btn" onclick="addClient()">Agregar cliente</button>
            </div>
        </div>

        <!-- Modal Confirmar Reset -->
        <div id="resetConfirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">‚ö†Ô∏è Confirmar reinicio</div>
                    <span class="close-modal" onclick="closeResetConfirmModal()">√ó</span>
                </div>
                
                <div style="padding: 16px 0; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 16px;">üóëÔ∏è</div>
                    <div style="font-weight: 600; font-size: 18px; margin-bottom: 8px;">¬øEliminar todos los datos?</div>
                    <div style="color: #6f7b8a; margin-bottom: 24px;">
                        Se borrar√°n productos, ventas, clientes y configuraciones. Esta acci√≥n no se puede deshacer.
                    </div>
                </div>
                
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-outline" style="flex: 1;" onclick="closeResetConfirmModal()">Cancelar</button>
                    <button class="btn btn-danger" style="flex: 1;" onclick="resetAllData()">S√≠, reiniciar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== ESTADO GLOBAL =====
        let catalogProducts = [];
        let ventas = [];
        let gastos = [];
        let clientes = [];
        let notifications = [];
        let nextFacturaNum = 1;
        let currentReceipt = null;

        // ===== INICIALIZACI√ìN =====
// ===== GESTI√ìN DE PEDIDOS DESDE EL CAT√ÅLOGO =====
const PEDIDOS_KEY = 'pedidos_pendientes';
const CONFIRMADOS_KEY = 'pedidos_confirmados';
const STORAGE_KEY = 'catalogo_tienda';

// ===== INICIALIZAR GESTI√ìN DE PEDIDOS =====
function initGestionPedidos() {
    // Escuchar nuevos pedidos
    window.addEventListener('storage', function(e) {
        if (e.key === 'nuevo_pedido_' || (e.key && e.key.startsWith('nuevo_pedido_'))) {
            cargarPedidosPendientes();
        }
        if (e.key === 'notificar_pedido') {
            cargarPedidosPendientes();
            actualizarContadorNotificaciones();
        }
    });
    
    // Cargar pedidos al inicio
    cargarPedidosPendientes();
    
    // Agregar pesta√±a de "Pedidos" al men√∫ principal
    agregarModuloPedidos();
}

// ===== AGREGAR M√ìDULO DE PEDIDOS AL MEN√ö =====
function agregarModuloPedidos() {
    // Esperar a que el DOM est√© listo
    setTimeout(() => {
        const menuGrid = document.querySelector('.modules-grid');
        if (menuGrid) {
            const itemPedidos = document.createElement('div');
            itemPedidos.className = 'module-item';
            itemPedidos.setAttribute('onclick', 'showScreen("pedidos-screen")');
            itemPedidos.innerHTML = `
                <div class="module-icon">üõí</div>
                <span>Pedidos</span>
            `;
            menuGrid.appendChild(itemPedidos);
        }
        
        // Crear la pantalla de pedidos si no existe
        if (!document.getElementById('pedidos-screen')) {
            const pedidosScreen = document.createElement('div');
            pedidosScreen.id = 'pedidos-screen';
            pedidosScreen.className = 'screen';
            pedidosScreen.innerHTML = `
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                    <span style="font-size: 28px; cursor: pointer;" onclick="goBack()">‚Üê</span>
                    <h1 style="font-size: 24px; font-weight: 700;">üõí Pedidos</h1>
                </div>
                <div id="pedidosLista" class="list-card"></div>
            `;
            document.querySelector('.app-container').appendChild(pedidosScreen);
        }
    }, 500);
}

// ===== CARGAR PEDIDOS PENDIENTES =====
function cargarPedidosPendientes() {
    const pedidos = JSON.parse(localStorage.getItem(PEDIDOS_KEY) || '[]');
    const container = document.getElementById('pedidosLista');
    
    if (!container) return;
    
    if (pedidos.length === 0) {
        container.innerHTML = '<div class="list-item">No hay pedidos pendientes</div>';
        return;
    }
    
    let html = '';
    pedidos.forEach((p, index) => {
        if (p.estado === 'pendiente') {
            html += `
                <div style="background: white; border-radius: 16px; padding: 16px; margin-bottom: 16px; border: 1px solid #e9ecf0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span style="font-weight: 700;">${p.producto.emoji} ${p.producto.name}</span>
                        <span style="background: #f39c12; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px;">Pendiente</span>
                    </div>
                    <div style="font-size: 14px; margin-bottom: 8px;">
                        üë§ ${p.cliente} ¬∑ üì± ${p.telefono}
                    </div>
                    <div style="font-size: 14px; margin-bottom: 12px;">
                        üí∞ Total: $${p.total.toFixed(2)} ¬∑ ${p.cuotas} cuota(s) ¬∑ $${p.montoPorCuota.toFixed(2)} c/u
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn" style="flex: 1; background: #2ecc71;" onclick="confirmarPedido(${index})">
                            ‚úÖ Confirmar
                        </button>
                        <button class="btn btn-danger" style="flex: 1;" onclick="rechazarPedido(${index})">
                            ‚ùå Rechazar
                        </button>
                    </div>
                    <div style="margin-top: 8px; font-size: 12px; color: #6f7b8a;">
                        üìÖ ${new Date(p.fecha).toLocaleString()}
                    </div>
                </div>
            `;
        }
    });
    
    container.innerHTML = html;
    actualizarContadorNotificaciones();
}

// ===== CONFIRMAR PEDIDO =====
function confirmarPedido(index) {
    const pedidos = JSON.parse(localStorage.getItem(PEDIDOS_KEY) || '[]');
    const pedido = pedidos[index];
    
    if (!pedido) return;
    
    // Verificar stock
    const producto = catalogProducts.find(p => p.id === pedido.producto.id);
    if (!producto || producto.stock < pedido.cantidad) {
        showToast('‚ùå Stock insuficiente');
        return;
    }
    
    // Restar stock
    producto.stock -= pedido.cantidad;
    
    // Actualizar estado
    pedido.estado = 'aceptado';
    pedido.fechaConfirmacion = new Date().toISOString();
    
    // Mover a confirmados
    let confirmados = JSON.parse(localStorage.getItem(CONFIRMADOS_KEY) || '[]');
    confirmados.unshift(pedido);
    localStorage.setItem(CONFIRMADOS_KEY, JSON.stringify(confirmados));
    
    // Eliminar de pendientes
    pedidos.splice(index, 1);
    localStorage.setItem(PEDIDOS_KEY, JSON.stringify(pedidos));
    
    // Guardar productos actualizados
    localStorage.setItem(STORAGE_KEY, JSON.stringify(catalogProducts));
    
    // Notificar al cat√°logo que el pedido fue confirmado
    localStorage.setItem('confirmado_' + pedido.id, JSON.stringify(pedido));
    localStorage.removeItem('nuevo_pedido_' + pedido.id);
    
    // Crear venta autom√°ticamente
    crearVentaDesdePedido(pedido);
    
    showToast('‚úÖ Pedido confirmado');
    cargarPedidosPendientes();
    renderInventory();
    updateDashboard();
}

// ===== RECHAZAR PEDIDO =====
function rechazarPedido(index) {
    const pedidos = JSON.parse(localStorage.getItem(PEDIDOS_KEY) || '[]');
    const pedido = pedidos[index];
    
    pedido.estado = 'rechazado';
    pedido.fechaRechazo = new Date().toISOString();
    
    // Guardar en rechazados (opcional)
    let rechazados = JSON.parse(localStorage.getItem('pedidos_rechazados') || '[]');
    rechazados.unshift(pedido);
    localStorage.setItem('pedidos_rechazados', JSON.stringify(rechazados));
    
    // Eliminar de pendientes
    pedidos.splice(index, 1);
    localStorage.setItem(PEDIDOS_KEY, JSON.stringify(pedidos));
    
    // Notificar rechazo
    localStorage.setItem('rechazado_' + pedido.id, JSON.stringify(pedido));
    
    showToast('‚ùå Pedido rechazado');
    cargarPedidosPendientes();
}

// ===== CREAR VENTA DESDE PEDIDO CONFIRMADO =====
function crearVentaDesdePedido(pedido) {
    const venta = {
        id: ventas.length + 1,
        factura: `P-${nextFacturaNum}`,
        fecha: new Date(),
        cliente: pedido.cliente,
        producto: pedido.producto.name,
        emoji: pedido.producto.emoji,
        cantidad: pedido.cantidad,
        precioUnitario: pedido.producto.price,
        subtotal: pedido.producto.price,
        itbms: pedido.producto.price * 0.07,
        total: pedido.producto.price * 1.07,
        metodo: 'Pedido confirmado',
        cuotas: pedido.cuotas,
        montoPorCuota: pedido.montoPorCuota
    };
    
    ventas.unshift(venta);
    nextFacturaNum++;
    saveToStorage();
    renderVentas();
}

// ===== ACTUALIZAR CONTADOR DE NOTIFICACIONES =====
function actualizarContadorNotificaciones() {
    const pedidos = JSON.parse(localStorage.getItem(PEDIDOS_KEY) || '[]');
    const pendientes = pedidos.filter(p => p.estado === 'pendiente').length;
    
    const badge = document.getElementById('notificationCount');
    if (badge) {
        if (pendientes > 0) {
            badge.textContent = pendientes;
            badge.style.display = 'block';
        } else {
            badge.style.display = 'none';
        }
    }
}

// ===== INICIAR CUANDO CARGUE LA APP =====
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(initGestionPedidos, 1000);
});
        function initializeData() {
            // Cargar datos guardados
            const savedData = localStorage.getItem('quicktreinta_data');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    catalogProducts = data.catalogProducts || [];
                    ventas = data.ventas || [];
                    gastos = data.gastos || [];
                    clientes = data.clientes || [];
                    notifications = data.notifications || [];
                    nextFacturaNum = data.nextFacturaNum || 1;
                } catch (e) {
                    console.error('Error cargando datos');
                    setDefaultData();
                }
            } else {
                setDefaultData();
            }
            
            // ACTUALIZAR LINK DEL CAT√ÅLOGO - ¬°AHORA S√ç!
            updateCatalogLink();
            
            // Actualizar toda la UI
            updateAllUI();
        }

        function setDefaultData() {
            // Productos de ejemplo
            catalogProducts = [
                { id: 1, name: "Pan franc√©s", description: "Pan fresco del d√≠a", price: 2.50, stock: 98, emoji: "ü•ñ" },
                { id: 2, name: "Pastel de fresa", description: "Delicioso pastel casero", price: 15.00, stock: 23, emoji: "üç∞" }
            ];
            
            // Clientes de ejemplo
            clientes = [
                { id: 1, nombre: "Mar√≠a L√≥pez", telefono: "6123-4567", deuda: 0 },
                { id: 2, nombre: "Carlos Ruiz", telefono: "6234-5678", deuda: 45000 }
            ];
            
            nextFacturaNum = 101;
        }

        // ===== PERSISTENCIA =====
        function saveToStorage() {
            const data = {
                catalogProducts,
                ventas,
                gastos,
                clientes,
                notifications,
                nextFacturaNum
            };
            localStorage.setItem('quicktreinta_data', JSON.stringify(data));
        }

        // ===== FUNCI√ìN CLAVE: GENERAR LINK DEL CAT√ÅLOGO =====
        function updateCatalogLink() {
            const businessName = localStorage.getItem('businessName') || 'Mi Tienda';
            
            // Crear un ID √∫nico basado en el nombre y timestamp
            const timestamp = Date.now().toString().slice(-6);
            const businessSlug = businessName
                .toLowerCase()
                .replace(/[^a-z0-9]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
            
            // Generar link AMIGABLE y CRE√çBLE
            const catalogLink = `https://tienda.quicksell.app/${businessSlug}-${timestamp}`;
            
            // Guardar en localStorage para persistencia
            localStorage.setItem('catalogLink', catalogLink);
            
            // Actualizar TODOS los campos de link en la UI
            const catalogLinkInput = document.getElementById('catalogLink');
            const catalogLinkHomeInput = document.getElementById('catalogLinkHome');
            
            if (catalogLinkInput) catalogLinkInput.value = catalogLink;
            if (catalogLinkHomeInput) catalogLinkHomeInput.value = catalogLink;
            
            console.log('‚úÖ Link del cat√°logo generado:', catalogLink);
        }

        // ===== FUNCIONES PARA COMPARTIR EL LINK =====
        function copyCatalogLink(source) {
            let linkInput;
            if (source === 'home') {
                linkInput = document.getElementById('catalogLinkHome');
            } else {
                linkInput = document.getElementById('catalogLink');
            }
            
            if (linkInput) {
                linkInput.select();
                linkInput.setSelectionRange(0, 99999); // Para m√≥viles
                document.execCommand('copy');
                showToast('üìã Link copiado al portapapeles');
            } else {
                // Fallback: regenerar y copiar
                updateCatalogLink();
                setTimeout(() => copyCatalogLink(source), 100);
            }
        }

        function shareWhatsApp() {
            // Asegurar que el link existe
            let link = localStorage.getItem('catalogLink');
            if (!link) {
                updateCatalogLink();
                link = localStorage.getItem('catalogLink');
            }
            
            const businessName = localStorage.getItem('businessName') || 'Mi Tienda';
            const whatsappNumber = localStorage.getItem('whatsappNumber') || '';
            
            const text = `üõçÔ∏è *${businessName}*\n\n¬°Haz tu pedido por WhatsApp! Mira nuestro cat√°logo completo aqu√≠:\n${link}\n\nEscr√≠benos para hacer tu pedido üöÄ`;
            
            let waUrl;
            if (whatsappNumber) {
                // Limpiar el n√∫mero
                const cleanNumber = whatsappNumber.replace(/[^0-9]/g, '');
                waUrl = `https://wa.me/${cleanNumber}?text=${encodeURIComponent(text)}`;
            } else {
                waUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
            }
            
            window.open(waUrl, '_blank');
            showToast('üì≤ Compartiendo link...');
        }

        function previewCatalog() {
            // Asegurar que hay productos
            if (catalogProducts.length === 0) {
                showToast('üì¶ Agrega productos al cat√°logo primero');
                showScreen('catalogo-screen');
                return;
            }
            
            renderPublicCatalog();
            showScreen('catalogo-preview-screen');
        }

        // ===== CAT√ÅLOGO P√öBLICO =====
        function renderPublicCatalog() {
            const container = document.getElementById('catalogPublicList');
            if (!container) return;
            
            const businessName = localStorage.getItem('businessName') || 'Mi Tienda';
            document.getElementById('previewBusinessName').textContent = businessName;
            
            if (catalogProducts.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6f7b8a;">No hay productos disponibles</div>';
                return;
            }

            let html = '';
            catalogProducts.forEach(product => {
                if (product.stock > 0) {
                    html += `
                        <div class="catalog-product">
                            <div class="product-image">${product.emoji || 'üì¶'}</div>
                            <div class="product-info">
                                <div class="product-name">${product.name}</div>
                                <div class="product-description">${product.description || ''}</div>
                                <div class="product-price">$${product.price.toFixed(2)}</div>
                                <div class="product-stock">‚úì Stock: ${product.stock} uds</div>
                                <div class="product-actions">
                                    <button class="product-btn whatsapp" onclick="orderProduct(${product.id})">
                                        üì≤ Pedir por WhatsApp
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            container.innerHTML = html;
        }

        function orderProduct(productId) {
            const product = catalogProducts.find(p => p.id === productId);
            if (!product) return;
            
            const businessName = localStorage.getItem('businessName') || 'Mi Tienda';
            const whatsappNumber = localStorage.getItem('whatsappNumber') || '';
            
            const text = `Hola *${businessName}*, quiero hacer un pedido:\n\n*${product.emoji || 'üì¶'} ${product.name}*\n${product.description || ''}\nPrecio: $${product.price.toFixed(2)}\nCantidad: 1\n\nTotal: $${product.price.toFixed(2)}\n\n¬øEst√° disponible?`;
            
            let waUrl;
            if (whatsappNumber) {
                const cleanNumber = whatsappNumber.replace(/[^0-9]/g, '');
                waUrl = `https://wa.me/${cleanNumber}?text=${encodeURIComponent(text)}`;
            } else {
                waUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
            }
            
            window.open(waUrl, '_blank');
            
            // Notificaci√≥n
            const notification = {
                id: Date.now(),
                title: "üõí Nuevo pedido",
                body: `Cliente interesado en: ${product.emoji} ${product.name}`,
                time: "Ahora",
                read: false
            };
            notifications.unshift(notification);
            renderNotifications();
            saveToStorage();
        }

        // ===== RESET TOTAL =====
        function confirmReset() {
            document.getElementById('resetConfirmModal').classList.add('active');
        }

        function closeResetConfirmModal() {
            document.getElementById('resetConfirmModal').classList.remove('active');
        }

        function resetAllData() {
            // Limpiar todas las variables
            catalogProducts = [];
            ventas = [];
            gastos = [];
            clientes = [];
            notifications = [];
            nextFacturaNum = 1;
            
            // Limpiar localStorage
            localStorage.removeItem('quicktreinta_data');
            localStorage.removeItem('businessName');
            localStorage.removeItem('whatsappNumber');
            localStorage.removeItem('itbmsRate');
            localStorage.removeItem('catalogLink');
            
            // Restablecer nombre por defecto
            localStorage.setItem('businessName', 'Mi Tienda');
            
            // Regenerar link
            updateCatalogLink();
            
            closeResetConfirmModal();
            updateAllUI();
            showToast('‚úÖ Sistema reiniciado. Todos los datos han sido borrados.');
            showScreen('home-screen');
        }

        // ===== NAVEGACI√ìN =====
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active-screen'));
            const activeScreen = document.getElementById(screenId);
            if (activeScreen) activeScreen.classList.add('active-screen');

            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            const navMap = {
                'home-screen': 0,
                'catalogo-screen': 1,
                'ventas-screen': 2,
                'inventario-screen': 3,
                'config-screen': 4
            };
            if (navMap[screenId] !== undefined) {
                navItems[navMap[screenId]].classList.add('active');
            }

            // Actualizar datos al mostrar pantallas
            if (screenId === 'home-screen') updateDashboard();
            if (screenId === 'ventas-screen') renderVentas();
            if (screenId === 'inventario-screen') renderInventory();
            if (screenId === 'catalogo-screen') {
                renderCatalogProducts();
                updateCatalogLink(); // Refrescar link
            }
            if (screenId === 'catalogo-preview-screen') renderPublicCatalog();
            if (screenId === 'caja-screen') updateCaja();
            if (screenId === 'clientes-screen') renderClientes();
            if (screenId === 'config-screen') updateConfigScreen();
        }

        function goBack() {
            showScreen('home-screen');
        }

        // ===== GESTI√ìN DE PRODUCTOS =====
        function openAddProductModal() {
            document.getElementById('addProductModal').classList.add('active');
        }

        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('active');
            ['productName', 'productDescription', 'productPrice', 'productStock', 'productEmoji'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
        }

        function addProductToCatalog() {
            const name = document.getElementById('productName').value.trim();
            const description = document.getElementById('productDescription').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const emoji = document.getElementById('productEmoji').value.trim();

            if (!name || !price || !stock) {
                showToast('‚ö†Ô∏è Completa nombre, precio y stock');
                return;
            }

            const product = {
                id: Date.now(),
                name,
                description: description || 'Sin descripci√≥n',
                price,
                stock,
                emoji: emoji || 'üì¶'
            };

            catalogProducts.push(product);
            saveToStorage();
            renderCatalogProducts();
            renderInventory();
            renderPublicCatalog();
            closeAddProductModal();
            showToast('‚úÖ Producto agregado');
            updateDashboard();
        }

        function deleteProduct(productId) {
            if (confirm('¬øEliminar este producto?')) {
                catalogProducts = catalogProducts.filter(p => p.id !== productId);
                saveToStorage();
                renderCatalogProducts();
                renderInventory();
                renderPublicCatalog();
                showToast('üóëÔ∏è Producto eliminado');
                updateDashboard();
            }
        }

        function editProduct(productId) {
            const product = catalogProducts.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('productName').value = product.name;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productEmoji').value = product.emoji;
            
            catalogProducts = catalogProducts.filter(p => p.id !== productId);
            openAddProductModal();
        }

        function renderCatalogProducts() {
            const container = document.getElementById('catalogProductList');
            if (!container) return;
            
            if (catalogProducts.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6f7b8a;">No hay productos. ¬°Agrega tu primer producto!</div>';
                return;
            }

            let html = '';
            catalogProducts.forEach(product => {
                html += `
                    <div class="catalog-product">
                        <div class="product-image">${product.emoji || 'üì¶'}</div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-description">${product.description}</div>
                            <div class="product-price">$${product.price.toFixed(2)}</div>
                            <div class="product-stock">Stock: ${product.stock} uds</div>
                            <div class="product-actions">
                                <button class="product-btn edit" onclick="editProduct(${product.id})">‚úèÔ∏è Editar</button>
                                <button class="product-btn delete" onclick="deleteProduct(${product.id})">üóëÔ∏è Eliminar</button>
                                <button class="product-btn whatsapp" onclick="shareProduct(${product.id})">üì≤ Compartir</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function shareProduct(productId) {
            const product = catalogProducts.find(p => p.id === productId);
            if (!product) return;
            
            const text = `*${product.emoji} ${product.name}*\n${product.description}\nPrecio: $${product.price.toFixed(2)}\nStock: ${product.stock} uds`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        function renderInventory() {
            const container = document.getElementById('inventoryList');
            if (!container) return;
            
            if (catalogProducts.length === 0) {
                container.innerHTML = '<div class="list-item">No hay productos en inventario</div>';
                return;
            }

            let html = '';
            catalogProducts.forEach(product => {
                html += `<div class="list-item"><span>${product.emoji || 'üì¶'} ${product.name}</span><span>${product.stock} uds</span></div>`;
            });
            container.innerHTML = html;
            
            const stockCritico = catalogProducts.filter(p => p.stock < 20);
            const stockCriticoContainer = document.getElementById('stockCriticoLista');
            if (stockCriticoContainer) {
                if (stockCritico.length === 0) {
                    stockCriticoContainer.innerHTML = '<div style="color: #2ecc71;">‚úÖ Stock suficiente</div>';
                } else {
                    let htmlCritico = '';
                    stockCritico.forEach(p => {
                        htmlCritico += `<div>${p.emoji || 'üì¶'} ${p.name}: ${p.stock} uds</div>`;
                    });
                    stockCriticoContainer.innerHTML = htmlCritico;
                }
            }
        }

        // ===== VENTAS Y RECIBOS =====
        function openAddSaleModal() {
            const clientSelect = document.getElementById('saleClient');
            if (clientSelect) {
                let options = '<option value="Mostrador">Mostrador (Cliente general)</option>';
                clientes.forEach(c => {
                    options += `<option value="${c.nombre}">${c.nombre}</option>`;
                });
                clientSelect.innerHTML = options;
            }

            const productSelect = document.getElementById('saleProduct');
            if (productSelect) {
                let options = '<option value="">Selecciona un producto</option>';
                catalogProducts.forEach(p => {
                    if (p.stock > 0) {
                        options += `<option value="${p.id}" data-price="${p.price}" data-name="${p.name}" data-emoji="${p.emoji}">${p.emoji || 'üì¶'} ${p.name} - $${p.price.toFixed(2)}</option>`;
                    }
                });
                productSelect.innerHTML = options;
            }
            
            document.getElementById('addSaleModal').classList.add('active');
            calculateSaleTotal();
        }

        function closeAddSaleModal() {
            document.getElementById('addSaleModal').classList.remove('active');
        }

        function calculateSaleTotal() {
            const productSelect = document.getElementById('saleProduct');
            const quantity = parseInt(document.getElementById('saleQuantity').value) || 1;
            
            if (productSelect && productSelect.selectedIndex > 0) {
                const selectedOption = productSelect.options[productSelect.selectedIndex];
                const price = parseFloat(selectedOption.dataset.price) || 0;
                
                const subtotal = price * quantity;
                const itbmsRate = parseFloat(localStorage.getItem('itbmsRate') || '7') / 100;
                const tax = subtotal * itbmsRate;
                const total = subtotal + tax;
                
                document.getElementById('saleSubtotal').innerHTML = `$${subtotal.toFixed(2)}`;
                document.getElementById('saleTax').innerHTML = `$${tax.toFixed(2)}`;
                document.getElementById('saleTotal').innerHTML = `$${total.toFixed(2)}`;
            }
        }

        function registerSale() {
            const client = document.getElementById('saleClient').value;
            const productSelect = document.getElementById('saleProduct');
            const quantity = parseInt(document.getElementById('saleQuantity').value);
            const paymentMethod = document.getElementById('salePaymentMethod').value;
            
            if (!productSelect || productSelect.selectedIndex <= 0) {
                showToast('‚ö†Ô∏è Selecciona un producto');
                return;
            }
            
            const selectedOption = productSelect.options[productSelect.selectedIndex];
            const productId = parseInt(selectedOption.value);
            const product = catalogProducts.find(p => p.id === productId);
            
            if (!product) {
                showToast('‚ö†Ô∏è Producto no encontrado');
                return;
            }
            
            if (product.stock < quantity) {
                showToast(`‚ö†Ô∏è Stock insuficiente. Disponible: ${product.stock} uds`);
                return;
            }
            
            product.stock -= quantity;
            
            const subtotal = product.price * quantity;
            const itbmsRate = parseFloat(localStorage.getItem('itbmsRate') || '7') / 100;
            const tax = subtotal * itbmsRate;
            const total = subtotal + tax;
            
            const facturaNum = nextFacturaNum.toString().padStart(4, '0');
            const venta = {
                id: ventas.length + 1,
                factura: `F-${facturaNum}`,
                fecha: new Date(),
                cliente: client,
                producto: product.name,
                emoji: product.emoji,
                cantidad: quantity,
                precioUnitario: product.price,
                subtotal: subtotal,
                itbms: tax,
                total: total,
                metodo: paymentMethod
            };
            
            ventas.unshift(venta);
            nextFacturaNum++;
            
            generateReceipt(venta);
            saveToStorage();
            renderVentas();
            updateDashboard();
            renderInventory();
            renderCatalogProducts();
            renderPublicCatalog();
            closeAddSaleModal();
        }

        function generateReceipt(venta) {
            const businessName = localStorage.getItem('businessName') || 'Mi Tienda';
            const fecha = new Date(venta.fecha);
            const fechaStr = `${fecha.getDate().toString().padStart(2,'0')}/${(fecha.getMonth()+1).toString().padStart(2,'0')}/${fecha.getFullYear()} ${fecha.getHours().toString().padStart(2,'0')}:${fecha.getMinutes().toString().padStart(2,'0')}`;
            
            const receiptText = 
`‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       *${businessName}*
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     RECIBO DE VENTA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Factura: ${venta.factura}
Fecha: ${fechaStr}
Cliente: ${venta.cliente}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

${venta.emoji || 'üì¶'} ${venta.producto}
   ${venta.cantidad} x $${venta.precioUnitario.toFixed(2)}
   Subtotal: $${venta.subtotal.toFixed(2)}

ITBMS: $${venta.itbms.toFixed(2)}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
*TOTAL: $${venta.total.toFixed(2)}*
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√©todo de pago: ${venta.metodo}

¬°Gracias por su compra!
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê`;

            currentReceipt = {
                text: receiptText,
                venta: venta
            };
            
            document.getElementById('receiptContent').innerHTML = receiptText.replace(/\n/g, '<br>').replace(/\*/g, '');
            document.getElementById('receiptModal').classList.add('active');
        }

        function closeReceiptModal() {
            document.getElementById('receiptModal').classList.remove('active');
        }

        function copyReceipt() {
            if (currentReceipt) {
                const textarea = document.createElement('textarea');
                textarea.value = currentReceipt.text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast('üìã Recibo copiado');
            }
        }

        function shareReceiptWhatsApp() {
            if (currentReceipt) {
                const text = currentReceipt.text;
                window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            }
        }

        function renderVentas() {
            const container = document.getElementById('ventasLista');
            const ultimasContainer = document.getElementById('ultimasVentasLista');
            
            if (ventas.length === 0) {
                if (container) container.innerHTML = '<div class="list-item">No hay ventas registradas</div>';
                if (ultimasContainer) ultimasContainer.innerHTML = '<div class="list-item">No hay ventas recientes</div>';
                return;
            }

            if (container) {
                let html = '';
                ventas.slice(0, 10).forEach(v => {
                    html += `<div class="list-item"><span>${v.factura} - ${v.cliente}</span><span>$${v.total.toFixed(2)}</span></div>`;
                });
                container.innerHTML = html;
            }
            
            if (ultimasContainer) {
                let html = '';
                ventas.slice(0, 3).forEach(v => {
                    html += `<div class="list-item"><span>${v.emoji || 'üí∞'} ${v.producto}</span><span>$${v.total.toFixed(2)}</span></div>`;
                });
                ultimasContainer.innerHTML = html;
            }
        }

        // ===== GASTOS =====
        function openAddExpenseModal() {
            document.getElementById('addExpenseModal').classList.add('active');
        }

        function closeAddExpenseModal() {
            document.getElementById('addExpenseModal').classList.remove('active');
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseAmount').value = '';
        }

        function registerExpense() {
            const category = document.getElementById('expenseCategory').value;
            const description = document.getElementById('expenseDescription').value.trim();
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            
            if (!description || !amount) {
                showToast('‚ö†Ô∏è Completa todos los campos');
                return;
            }
            
            const gasto = {
                id: gastos.length + 1,
                categoria: category,
                descripcion: description,
                monto: amount,
                fecha: new Date()
            };
            
            gastos.unshift(gasto);
            saveToStorage();
            updateDashboard();
            closeAddExpenseModal();
            showToast(`‚úÖ Gasto registrado: $${amount.toFixed(2)}`);
        }

        // ===== CLIENTES =====
        function openAddClientModal() {
            document.getElementById('addClientModal').classList.add('active');
        }

        function closeAddClientModal() {
            document.getElementById('addClientModal').classList.remove('active');
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
        }

        function addClient() {
            const name = document.getElementById('clientName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();
            
            if (!name) {
                showToast('‚ö†Ô∏è El nombre es requerido');
                return;
            }
            
            const client = {
                id: clientes.length + 1,
                nombre: name,
                telefono: phone || 'Sin tel√©fono',
                deuda: 0
            };
            
            clientes.push(client);
            saveToStorage();
            renderClientes();
            closeAddClientModal();
            showToast('‚úÖ Cliente agregado');
        }

        function renderClientes() {
            const container = document.getElementById('clientesLista');
            if (!container) return;
            
            if (clientes.length === 0) {
                container.innerHTML = '<div class="list-item">No hay clientes registrados</div>';
                document.getElementById('deudaPendiente').innerHTML = 'Sin deudas pendientes';
                return;
            }
            
            let html = '';
            clientes.forEach(c => {
                const color = c.deuda > 0 ? '#e67e22' : '#2ecc71';
                html += `<div class="list-item"><span>${c.nombre}</span><span style="color: ${color};">üí∞ $${c.deuda.toLocaleString()}</span></div>`;
            });
            container.innerHTML = html;
            
            const deudor = clientes.find(c => c.deuda > 0);
            document.getElementById('deudaPendiente').innerHTML = deudor ? 
                `${deudor.nombre} debe $${deudor.deuda.toLocaleString()}` : 
                'Sin deudas pendientes';
        }

        // ===== DASHBOARD =====
        function updateDashboard() {
            const hoy = new Date().toDateString();
            const ayer = new Date(Date.now() - 86400000).toDateString();
            const semana = new Date(Date.now() - 604800000);
            
            const ventasHoy = ventas.filter(v => new Date(v.fecha).toDateString() === hoy);
            const ventasAyer = ventas.filter(v => new Date(v.fecha).toDateString() === ayer);
            const ventasSemana = ventas.filter(v => new Date(v.fecha) >= semana);
            
            const totalVentasHoy = ventasHoy.reduce((sum, v) => sum + v.total, 0);
            const totalVentasAyer = ventasAyer.reduce((sum, v) => sum + v.total, 0);
            const totalVentasSemana = ventasSemana.reduce((sum, v) => sum + v.total, 0);
            
            const gastosHoy = gastos.filter(g => new Date(g.fecha).toDateString() === hoy);
            const totalGastosHoy = gastosHoy.reduce((sum, g) => sum + g.monto, 0);
            
            const totalVentas = ventas.reduce((sum, v) => sum + v.total, 0);
            const totalGastos = gastos.reduce((sum, g) => sum + g.monto, 0);
            const saldo = totalVentas - totalGastos;
            
            // Actualizar UI
            document.getElementById('ventasHoy').innerHTML = `$${totalVentasHoy.toFixed(2)}`;
            document.getElementById('ventasHoyScreen').innerHTML = `$${totalVentasHoy.toFixed(2)}`;
            document.getElementById('ventasHoyCaja').innerHTML = `+$${totalVentasHoy.toFixed(2)}`;
            document.getElementById('ventasAyerScreen').innerHTML = `$${totalVentasAyer.toFixed(2)}`;
            document.getElementById('ventasSemanaScreen').innerHTML = `$${totalVentasSemana.toFixed(2)}`;
            
            document.getElementById('pedidosHoy').innerHTML = ventasHoy.length;
            document.getElementById('totalProductos').innerHTML = catalogProducts.length;
            
            document.getElementById('saldoDisponible').innerHTML = `$${saldo.toFixed(2)}`;
            document.getElementById('transaccionesHoy').innerHTML = `${ventasHoy.length} transacciones`;
            document.getElementById('gastosHoyMonto').innerHTML = `-$${totalGastosHoy.toFixed(2)}`;
            document.getElementById('gastosHoyCount').innerHTML = `${gastosHoy.length} registros`;
            
            if (totalVentasAyer > 0) {
                const porcentaje = ((totalVentasHoy - totalVentasAyer) / totalVentasAyer * 100).toFixed(0);
                document.getElementById('ventasHoyPorcentaje').innerHTML = `${porcentaje > 0 ? '+' : ''}${porcentaje}%`;
            }
        }

        function updateCaja() {
            updateDashboard();
        }

        // ===== CONFIGURACI√ìN =====
        function openEditNameModal() {
            document.getElementById('editNameModal').classList.add('active');
            const currentName = localStorage.getItem('businessName') || 'Mi Tienda';
            document.getElementById('businessNameInput').value = currentName;
        }

        function closeEditNameModal() {
            document.getElementById('editNameModal').classList.remove('active');
        }

        function saveBusinessName() {
            const name = document.getElementById('businessNameInput').value.trim();
            if (name) {
                localStorage.setItem('businessName', name);
                document.getElementById('businessNameDisplay').textContent = name;
                document.getElementById('businessNameHome').textContent = name;
                document.getElementById('configBusinessName').textContent = name;
                
                // ACTUALIZAR LINK CON EL NUEVO NOMBRE
                updateCatalogLink();
                
                closeEditNameModal();
                showToast('‚úÖ Nombre actualizado');
            }
        }

        function openSettingsModal() {
            document.getElementById('settingsModal').classList.add('active');
            document.getElementById('itbmsRate').value = localStorage.getItem('itbmsRate') || '7';
            document.getElementById('whatsappNumber').value = localStorage.getItem('whatsappNumber') || '';
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function saveSettings() {
            localStorage.setItem('itbmsRate', document.getElementById('itbmsRate').value);
            localStorage.setItem('whatsappNumber', document.getElementById('whatsappNumber').value.trim());
            showToast('‚úÖ Configuraci√≥n guardada');
            closeSettingsModal();
        }

        function updateConfigScreen() {
            const name = localStorage.getItem('businessName') || 'Mi Tienda';
            document.getElementById('configBusinessName').textContent = name;
        }

        // ===== NOTIFICACIONES =====
        function openNotificationsModal() {
            document.getElementById('notificationsModal').classList.add('active');
            renderNotifications();
        }

        function closeNotificationsModal() {
            document.getElementById('notificationsModal').classList.remove('active');
        }

        function renderNotifications() {
            const container = document.getElementById('notificationsList');
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #6f7b8a;">
                        <div style="font-size: 48px; margin-bottom: 12px;">üîî</div>
                        <div style="font-weight: 600; margin-bottom: 4px;">No hay notificaciones</div>
                        <div style="font-size: 14px;">Cuando alguien pida por WhatsApp, ver√°s la notificaci√≥n aqu√≠</div>
                    </div>
                `;
                document.getElementById('notificationCount').style.display = 'none';
                return;
            }

            let html = '';
            notifications.forEach((notif, index) => {
                html += `
                    <div class="notification-item ${notif.read ? '' : 'unread'}">
                        <div class="notification-header">
                            <div class="notification-title">${notif.title}</div>
                            <div class="notification-time">${notif.time}</div>
                        </div>
                        <div class="notification-body">${notif.body}</div>
                    </div>
                `;
                notif.read = true;
            });
            container.innerHTML = html;
            document.getElementById('notificationCount').style.display = 'none';
            saveToStorage();
        }

        // ===== UTILIDADES =====
        function showToast(message) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function openQuickSellDemo() {
            showToast('‚ö° Usa "Registrar venta" en el m√≥dulo Ventas');
            showScreen('ventas-screen');
        }

        function generateSalesReport() {
            const totalVentas = ventas.reduce((sum, v) => sum + v.total, 0);
            const totalProductosVendidos = ventas.reduce((sum, v) => sum + v.cantidad, 0);
            
            let reporte = `üìä REPORTE DE VENTAS\n\n`;
            reporte += `Total ventas: $${totalVentas.toFixed(2)}\n`;
            reporte += `Productos vendidos: ${totalProductosVendidos}\n`;
            reporte += `Transacciones: ${ventas.length}\n\n`;
            
            if (ventas.length > 0) {
                reporte += `√öltima venta: ${ventas[0].factura} - $${ventas[0].total.toFixed(2)}\n`;
            }
            
            window.open(`https://wa.me/?text=${encodeURIComponent(reporte)}`, '_blank');
        }

        function exportInventory() {
            let inventario = `üì¶ INVENTARIO ${localStorage.getItem('businessName') || 'Mi Tienda'}\n\n`;
            catalogProducts.forEach(p => {
                inventario += `${p.emoji || 'üì¶'} ${p.name}: ${p.stock} uds - $${p.price.toFixed(2)}\n`;
            });
            window.open(`https://wa.me/?text=${encodeURIComponent(inventario)}`, '_blank');
        }

        function updateAllUI() {
            renderCatalogProducts();
            renderInventory();
            renderPublicCatalog();
            renderVentas();
            renderClientes();
            updateDashboard();
        }

        // ===== EVENT LISTENERS =====
        window.addEventListener('DOMContentLoaded', () => {
            initializeData();
            
            const saleProduct = document.getElementById('saleProduct');
            const saleQuantity = document.getElementById('saleQuantity');
            if (saleProduct) saleProduct.addEventListener('change', calculateSaleTotal);
            if (saleQuantity) saleQuantity.addEventListener('input', calculateSaleTotal);
        });

        // Prevenir comportamiento por defecto
        document.querySelectorAll('a[href="#"]').forEach(link => {
            link.addEventListener('click', (e) => e.preventDefault());
        });
    </script>
</body>

</html>
